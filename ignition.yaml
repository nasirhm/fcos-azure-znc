variant: fcos
version: 1.1.0

passwd:
  users:
    - name: core
      ssh_authorized_keys:
        - YOUR_SSH_KEY_HERE

storage:
  files:
    - path: /etc/hostname
      mode: 0644
      contents:
        inline: cosmos
    - path: /etc/.znc/configs/znc.conf
      mode: 0644
      contents: 
        inline: |
          // WARNING
          //
          // Do NOT edit this file while ZNC is running!
          // Use webadmin or *controlpanel instead.
          //
          // Altering this file by hand will forfeit all support.
          //
          // But if you feel risky, you might want to read help on /znc saveconfig and /znc rehash.
          // Also check https://wiki.znc.in/Configuration
          Version = 1.8.2
          <Listener l>
              Port = 12345
              IPv4 = true
              IPv6 = true
              SSL = false
          </Listener>
          LoadModule = webadmin

          <User nasirhm>
              Pass       = ${PASS_HERE}
              Admin      = true
              Nick       = nasirhm
              AltNick    = nasirhm_
              Ident      = nasirhm
              LoadModule = chansaver
              LoadModule = controlpanel
              <Network freenode>
                  LoadModule = simple_away
                  Server     = chat.freenode.net +6697

                  <Chan #fedora-coreos>
                  </Chan>
              </Network>
          </User>

systemd:
  units:
    - name: znc.service
      enabled: true
      contents: |
        [Unit]
        Description=ZNC IRC Bouncer
        After=network-online.target
        Wants=network-online.target

        [Service]
        TimeoutStartSec=0
        ExecStartPre=-/bin/podman kill znc-irc-bouncer
        ExecStartPre=-/bin/podman rm znc-irc-bouncer
        ExecStartPre=/bin/podman pull znc
        ExecStart=/bin/podman run --name znc-irc-bouncer -p 12345:12345 -v /etc/.znc:/znc-data:z znc
        ExecStop=/bin/podman kill znc-irc-bouncer

        [Install]
        WantedBy=multi-user.target
